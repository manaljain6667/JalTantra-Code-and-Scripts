Sets
	nodes /1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73/
	pipes /0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11/
	src(nodes) /1/;
alias (src,srcs);
alias (nodes,j) ;
Set arcs(nodes,j) /2.72, 3.18, 4.28, 5.31, 6.4, 7.30, 8.53, 9.13, 10.63, 11.23, 12.55, 13.16, 14.9, 15.54, 16.23, 17.34, 18.37, 19.6, 20.35, 21.15, 22.11, 23.43, 24.48, 25.46, 26.24, 27.39, 28.14, 29.4, 30.3, 31.69, 32.44, 33.35, 34.32, 35.36, 36.66, 37.12, 38.26, 39.41, 40.8, 41.42, 42.5, 43.10, 44.21, 45.25, 46.52, 47.70, 48.12, 49.8, 50.17, 51.7, 52.3, 53.56, 54.36, 55.10, 56.20, 57.50, 58.34, 59.2, 60.49, 61.57, 62.51, 63.27, 64.69, 65.19, 66.14, 67.61, 68.65, 1.69, 70.58, 71.51, 72.49, 73.59, 63.12, 56.33, 63.23, 24.55, 45.51, 25.30, 72.40, 49.15, 31.1, 25.27, 53.40, 26.18, 73.62, 37.3, 48.26, 47.65, 57.17, 34.70, 60.15, 10.11, 67.21, 58.67, 6.29, 69.71, 62.2, 42.31, 36.9, 72.59, 43.11/

Parameters
	Len(nodes,j) /2    .72    200.8, 3    .18    29.57, 4    .28    31.29, 5    .31    119.0, 6    .4    33.08, 7    .30    61.72, 8    .53    32.21, 9    .13    5.953, 10    .63    37.92, 11    .23    19.43, 12    .55    29.29, 13    .16    21.32, 14    .9    27.1, 15    .54    72.45, 16    .23    18.3, 17    .34    88.14, 18    .37    40.18, 19    .6    36.35, 20    .35    25.04, 21    .15    60.74, 22    .11    25.85, 23    .43    9.297, 24    .48    3.901, 25    .46    46.78, 26    .24    41.85, 27    .39    35.69, 28    .14    17.37, 29    .4    32.69, 30    .3    98.03, 31    .69    114.5, 32    .44    14.71, 33    .35    13.46, 34    .32    107.8, 35    .36    36.74, 36    .66    41.51, 37    .12    26.64, 38    .26    24.28, 39    .41    98.5, 40    .8    110.6, 41    .42    104.8, 42    .5    16.17, 43    .10    12.56, 44    .21    73.93, 45    .25    56.38, 46    .52    87.09, 47    .70    53.61, 48    .12    11.47, 49    .8    103.6, 50    .17    68.97, 51    .7    99.29, 52    .3    19.45, 53    .56    22.33, 54    .36    38.95, 55    .10    7.538, 56    .20    97.41, 57    .50    115.1, 58    .34    105.3, 59    .2    40.85, 60    .49    80.8, 61    .57    53.33, 62    .51    145.7, 63    .27    39.05, 64    .69    50.47, 65    .19    6.883, 66    .14    44.2, 67    .61    143.4, 68    .65    13.87, 1    .69    119.9, 70    .58    19.45, 71    .51    126.4, 72    .49    122.5, 73    .59    48.32, 63    .12    50.93, 56    .33    104.6, 63    .23    56.92, 24    .55    39.67, 45    .51    188.9, 25    .30    153.3, 72    .40    186.3, 49    .15    263.0, 31    .1    178.1, 25    .27    145.7, 53    .40    142.1, 26    .18    67.69, 73    .62    250.9, 37    .3    48.62, 48    .26    45.6, 47    .65    264.5, 57    .17    139.6, 34    .70    113.4, 60    .15    311.9, 10    .11    28.18, 67    .21    333.3, 58    .67    449.9, 6    .29    65.76, 69    .71    231.3, 62    .2    339.9, 42    .31    122.1, 36    .9    83.83, 72    .59    235.7, 43    .11    23.07/
	E(nodes) / 1 45.0,  2 19.0,  3 13.0,  4 23.0,  5 17.0,  6 20.0,  7 12.0,  8 8.0,  9 14.0,  10 17.0,  11 17.0,  12 14.0,  13 13.0,  14 17.0,  15 14.0,  16 13.0,  17 11.0,  18 15.0,  19 10.0,  20 13.0,  21 19.0,  22 13.0,  23 14.0,  24 19.0,  25 15.0,  26 17.0,  27 18.0,  28 9.0,  29 10.0,  30 16.0,  31 17.0,  32 15.0,  33 23.0,  34 14.0,  35 19.0,  36 12.0,  37 20.0,  38 9.0,  39 14.0,  40 12.0,  41 18.0,  42 16.0,  43 17.0,  44 21.0,  45 21.0,  46 15.0,  47 12.0,  48 12.0,  49 16.0,  50 15.0,  51 12.0,  52 17.0,  53 18.0,  54 8.0,  55 19.0,  56 14.0,  57 15.0,  58 16.0,  59 18.0,  60 16.0,  61 15.0,  62 15.0,  63 14.0,  64 15.0,  65 19.0,  66 18.0,  67 15.0,  68 16.0,  69 21.0,  70 12.0,  71 12.0,  72 17.0, 73 17.0/
	P(nodes) / 1 0.0,  2 0.0,  3 0.0,  4 0.0,  5 0.0,  6 0.0,  7 0.0,  8 0.0,  9 0.0,  10 0.0,  11 0.0,  12 0.0,  13 0.0,  14 0.0,  15 0.0,  16 0.0,  17 0.0,  18 0.0,  19 0.0,  20 0.0,  21 0.0,  22 0.0,  23 0.0,  24 0.0,  25 0.0,  26 0.0,  27 0.0,  28 0.0,  29 0.0,  30 0.0,  31 0.0,  32 0.0,  33 0.0,  34 0.0,  35 0.0,  36 0.0,  37 0.0,  38 0.0,  39 0.0,  40 0.0,  41 0.0,  42 0.0,  43 0.0,  44 0.0,  45 0.0,  46 0.0,  47 0.0,  48 0.0,  49 0.0,  50 0.0,  51 0.0,  52 0.0,  53 0.0,  54 0.0,  55 0.0,  56 0.0,  57 0.0,  58 0.0,  59 0.0,  60 0.0,  61 0.0,  62 0.0,  63 0.0,  64 0.0,  65 0.0,  66 0.0,  67 0.0,  68 0.0,  69 0.0,  70 0.0,  71 0.0,  72 0.0, 73 0.0/
	D(nodes) / 1 -495.39012,  2 0.125,  3 0.0421,  4 0.0209,  5 0.0291,  6 0.0291,  7 0.0346,  8 0.053,  9 0.0251,  10 0.0185,  11 0.0208,  12 0.0254,  13 0.00586,  14 0.0191,  15 0.152,  16 0.00852,  17 0.0638,  18 0.0296,  19 0.0093,  20 0.0263,  21 0.101,  22 0.00556,  23 0.0223,  24 0.0184,  25 0.0865,  26 0.0386,  27 0.0474,  28 0.0105,  29 0.0212,  30 0.0673,  31 0.115,  32 0.0263,  33 0.0254,  34 0.0891,  35 0.0162,  36 0.0432,  37 0.0248,  38 0.00522,  39 0.0289,  40 0.0944,  41 0.0437,  42 0.0523,  43 0.00966,  44 0.0191,  45 0.0527,  46 0.0288,  47 0.0684,  48 0.0131,  49 0.123,  50 0.0396,  51 0.12,  52 0.0229,  53 0.0423,  54 0.024,  55 0.0164,  56 0.0482,  57 0.0,  58 0.17,  59 0.17,  60 0.17,  61 0.17,  62 1.47,  63 0.37,  64 0.101,  65 0.571,  66 0.103,  67 1.11,  68 0.0166,  69 0.619,  70 122.0,  71 122.0,  72 122.0, 73 122.0/
	dis(pipes) / 0 63.0,  1 75.0,  2 90.0,  3 110.0,  4 125.0,  5 140.0,  6 160.0,  7 180.0,  8 200.0,  9 250.0,  10 280.0, 11 315.0/
	C(pipes) / 0 116.0,  1 172.0,  2 231.0,  3 340.0,  4 461.0,  5 576.0,  6 750.0,  7 945.0,  8 1113.0,  9 1762.0,  10 2210.0, 11 2794.0/
	R(pipes) / 0 140.0,  1 140.0,  2 140.0,  3 140.0,  4 140.0,  5 140.0,  6 140.0,  7 140.0,  8 140.0,  9 140.0,  10 140.0, 11 140.0/

Scalar omega  /10.68/;
Scalar bnd ;
Scalar qm;
Scalar q_M;

bnd = sum(src,D(src));
q_M=-bnd;
qm=0;

Variable l(nodes,j,pipes); 
l.lo(nodes,j,pipes)= 0;

Variable q1(nodes,j);
q1.lo(nodes,j)=qm;
q1.up(nodes,j)=q_M;

Variable q2(nodes,j);
q2.lo(nodes,j)=qm;
q2.up(nodes,j)=q_M;

Variables z;

Variable h(nodes);

Equations cost "objective function",bound1(nodes,j,pipes),cons1(nodes),cons2(nodes),cons3(nodes,j),cons5(src), cons4(nodes,j), cons6(nodes,j) ;
cost..  z=e=sum(arcs(nodes,j),sum(pipes,l(arcs,pipes)*c(pipes)));
bound1(nodes,j,pipes)$arcs(nodes,j).. l(nodes,j,pipes) =l= Len(nodes,j);
cons1(nodes).. sum(arcs(j,nodes),(q1(arcs)-q2(arcs))) =e= sum(arcs(nodes,j),(q1(arcs)-q2(arcs))) + D(nodes);
cons2(nodes).. h(nodes) =g= E(nodes) + P(nodes);
cons3(arcs(nodes,j)).. h(nodes)-h(j)=e=sum(pipes,(((q1(arcs)*0.001)**1.852 - (q2(arcs)*0.001)**1.852)*omega*l(arcs,pipes))/((R(pipes)**1.852)*(dis(pipes)/1000)**4.87));
cons4(arcs(nodes,j)).. sum(pipes,l(arcs,pipes)) =e=Len(arcs);
cons5(src)..  h(src)=e= sum(srcs,E(srcs));
cons6(arcs(nodes,j)).. q1(arcs)*q2(arcs) =l= q_M*qm;

model m2  /all/  ;
solve m2 using minlp minimizing z ;
